# ConvFMML
MIDI→MML Converter  
Copyright (C) 2017 R.K.R.

## 概要
ConvFMMLはスタンダードMIDIファイル(SMF/MIDI)をFMP7・FMP・PMDなどで用いられているミュージックマクロランゲージ(MML)に変換するソフトです。  
以下のような処理が可能です。  

* FMP7モード、FMPモード、PMDモード、MXDRVモード、NRTDRVモード、カスタムモード指定によってそれぞれに適したMML形式で出力
* 小節ごとに音符・休符を改行・ブロック分け
* 音量、パンのコントロールチェンジ(CC)、プログラムチェンジ(PC)の出力
* テンポ指定の出力
* MML出力するMIDIトラックの指定
* MMLパート名の指定

各種設定は設定ファイル(ConvFMML.ini)で変更可能です。

### 変換できるMIDIのフォーマットについて
ConvFMMLで変換できるMIDIはフォーマット1のもののみです。  
フォーマット0または2のものはフォーマット1のものに変換して使用してください。

### モード機能について
ConvFMMLでは、モード変更によってタイ、音量、パン、テンポなどのMMLコマンドがそれぞれのMML形式のものに自動設定されます。  
カスタムモードではこれらをそれぞれ指定することが出来ます。  
MMLパート名の自動割り当て機能などもモード機能によって変化します。

### MML出力について
あらかじめ出力するMMLの分解能を設定ファイルに記述してください。  
出力ファイルはそれぞれのモードに対応した拡張子で自動作成されます。  
カスタムモードではデフォルトの出力ファイル拡張子が設定できます。  
FMPモードでは出力ファイルの拡張子(mpi、mvi、mzi)を選択することができます。  
なお出力ファイル名の指定はコマンドライン上でも可能です。  
MMLの整形では、拍子の指定を反映した小節のブロック分け(改行・スペース挿入)が可能です。  
デフォルトの拍子は4分の4拍子です。

### 音符・休符の出力について
音長は2^n・3\*2^n表現のものとクロックカウント値も用いたものを選択できます。  
また、音長表現は最短表記のものとできるだけ2^n分表記にしたものを選択できます。  
音符・休符の付点表記、和音分解が可能です。  
和音の構成数だけMMLパート数が増えます。  
オクターブ表記では相対オクターブ指定(<・>)の向きの指定などを行うことができます。  
複数音符・休符をつなげるタイを使用した音長表記についての設定が行うことができます。  
MIDIの調号指定によって音階表記を変更することが可能です。  
デフォルトはハ長調(シャープ・フラットなし)です。
　　
### CC・PC指定の出力について
ConvFMMLでは、音量、パンのCC、PCの出力を選択することができます。  
音符と重複した場合、これらをそのまま、またはノートオフ直後に記述するか削除するか選択することができます。  
不要なCC・PCを省略・削除することが可能です。  
なお、設定ファイルで設定できるCC・PCの省略・削除処理は、

1. 音符に影響を与えないCC・PCの処理(invalid_ccpc)
2. 同位置同種のCC・PCの処理(replace_ccpc)
3. 同種同値のCC・PCの処理(omit_ccpc)
4. 音符と重複したCC・PCの処理(overlap_ccpc)

の順番で行います。  
設定によっては適切に処理されないCC・PCが残ることがあります。  
PMD・MXDRV・NRTDRVモードでは、音量コマンドを2つのうちから選択することができます。  
また、パート名自動割り当て機能が有効のときは、音量値の幅が各パートに対応したものになります。  
カスタム・NRTDRVモードでは、音量値の幅を指定することができます。  
パンの右・左の割り当てをどのMIDI値で判断するか設定することができます。  
カスタムモードでは、パンコマンドをMIDI値のままか左・中央・右の3つに分けて出力するか選択できます。  
FMP7モードでは、パンコマンドのP表記、PL・PC・PR表記を選択できます。

### テンポ指定の出力について
ConvFMMLでは、テンポ指定の書き出しが可能です。  
テンポ指定が音符と重複している場合は自動でテンポパートを生成することもできます。

### トラック・パート指定について
ConvFMMLでは、音符のないMIDIトラックを自動削除したり、出力するMIDIトラックを指定することができます。  
MIDIトラックの番号は最初のものが1、次が2、3、...となり、通常はコンダクタートラックが1になります。  
また、MMLパート名を自動で割り当てることができます。  
FMP7・FMP・PMD・NRTDRVモードでは自動割り当て時のパート名のセットを選択することができます。  
設定ファイルでパート名をそれぞれ指定することも可能です。  
なお、パート名はMIDIトラック番号の若い順で割り当てられます。  
出力できるトラック・パート数は64までです。  
ただし、テンポパートはこの数に含みません。

### 変換精度について
MMLの分解能で表現できない長さの音符・休符は自動的に削除されます。  
MMLの分解能が高くなるほど変換精度は向上しますが、より細かい音符が出現します。

## 動作環境
Windows 8、Windows 10で確認済みです。

## ファイル構成
* ConvFMML.exe  (本体)
* ConvFMML.ini  (設定ファイル)
* history.txt   (更新履歴)
* README.md     (本書)
* LICENSE       (MITライセンス)

## インストール
ダウンロードした圧縮ファイルをインストールするフォルダに移動させ、解凍してください。

## 使用方法
変換するMIDIファイルをConvFMML.exeにドラッグ&ドロップしてください。  
また、コマンドラインから実行することも可能です。
```
　> ConvFMML.exe inputfile (outputfile)
```
`inputfile`: 変換するMIDIファイル  
`outputfile`: 出力するMMLファイル(省略時はMIDIファイルと同名のMMLを出力)

## アンインストール
インストールしたフォルダを削除してください。

## 著作権/ライセンス
本ソフトの著作権はR.K.R.が所有します。  
本ソフトのライセンスはMIT Licenseです。
